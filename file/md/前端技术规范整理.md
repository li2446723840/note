## 前端技术规范整理

#### 环境配置规范化

1. node版本统一使用**nvm**进行管理， 目前版本为**v10.15.3**
2. 编辑器统一vscode，并进行统一的setting.json配置（链接：[](http://jira.huixiaoer.com:8090/pages/viewpage.action?pageId=62981355)）建议vscode 终端使用bash，可使用 `"terminal.integrated.shell.windows": "C:\\Program Files\\Git\\bin\\bash.exe"` 后面的值为bash的安装目录
3. web程序建议使用**chrome**结合**devtools**插件工具进行开发调试

#### 项目技术栈规范（针对新项目+重构项目）

1. **pc类web项目**统一优先使用**vue全家桶+elementui**进行开发
2. **移动h5项目**推荐使用**vue全家桶+vant**进行开发
3. **官网类**涉及**seo相关**的推荐使用服务端渲染**nuxt优先**
4. **小程序**推荐使用**uni-app**进行开发
5. ##### 打包工具推荐使用**webpack**

#### 项目公共模板

- 暂时以vue-project-base为基础模板脚手架，地址：`git@gitlab.huixiaoer.com:hxeFE/vue-project-base.git`，通过指令进行拉取，详见：http://jira.huixiaoer.com:8090/pages/viewpage.action?pageId=39387245
- 后期会通过创建**远程preset**方式进行基础模板创建， 类似命令：`vue create --preset username/repo my-project`，这么做主要有以下优势：（计划1~2月时间内完成开发）
  - 集成在vue指令下，不需要额外安装插件，易于使用
  - 可以丰富指令集，根据指令可以实现集成pc模板、h5模板、是否使用额外服务或插件等等
  - 易于后期升级维护

#### 重要规范整理

##### 注释规范

1. 文件注释声明

   ```javscript
   /**
    * @description: 说明文字
    * @author: 张三
    */
   
   /**
    * @description: 说明文字
    * @author: 张三
    * @update: 更新内容 by 李四 2013-04-13
    */
   ```

2. 单行、多行注释，

   ```
   单行注释：
   /* this is a short comment */
   data(){
   	return {
   		message: "hello world" // 消息
   	}
   }
   
   多行注释：
   /*
   * this is comment line 1.
   * this is comment line 2.
   */
   ```

3. 函数或方法注释

   ```
   /**
    * @description 这是一个求和函数
    * @todo 功能待完善
    * @param  {Number} a 第一个数字
    * @param  {Number} b 第二个数字
    * @return {Number}   返回两个数字之和
    */
   var sum = function(a, b) {
       return a + b;
   }
   ```

4. 样式区块注释

   ```
   /* header */
   ...
   /* footer */
   ...
   ```

##### 采用gitflow规范

```
commit message格式：
<type>(<scope>): <subject>

type（必须）
type用于说明git commit的类别，只允许使用下面的标识。
feat：新功能（feature）。
fix/to：修复bug，可以是QA发现的BUG，也可以是研发自己发现的BUG。
fix：产生diff并自动修复此问题。适合于一次提交直接修复问题
to：只产生diff不自动修复此问题。适合于多次提交。最终修复问题提交时使用fix
style：格式（不影响代码运行的变动）。
refactor：重构（即不是新增功能，也不是修改bug的代码变动）。
test：增加测试。
merge：代码合并。
docs：文档（documentation）。
perf：优化相关，比如提升性能、体验。
chore：构建过程或辅助工具的变动。
revert：回滚到上一个版本。
sync：同步主线或分支的Bug

scope（可选）代表影响范围

subject（必须）
subject是commit目的的简短描述，不超过50个字符，使用中文描述。

例子： feat(Controller):用户查询接口开发
```



##### vue相关技巧规范

1. 对于使用**less、scss**定义的通用样式，使用**style-resources-loader插件**在vue.config.js进行配置实现全局注入

2. 使用日期处理插件**moment**时，需要**配置过滤语言包**

3. 通过hook监听生命周期：

   ```
   export default {
     mounted() {
       this.chart = echarts.init(this.$el)
       // 请求数据，赋值数据 等等一系列操作...
   
       // 监听窗口发生变化，resize组件
       window.addEventListener('resize', this.$_handleResizeChart)
       // 通过hook监听组件销毁钩子函数，并取消监听事件
       this.$once('hook:beforeDestroy', () => {
         window.removeEventListener('resize', this.$_handleResizeChart)
       })
     },
     updated() {},
     created() {},
     methods: {
       $_handleResizeChart() {
         // this.chart.resize()
       }
     }
   }
   ```
   
4. 将一些使用频繁的的方法注册到vue.prototype中

5. 移动端h5布局建议使用vw、vh布局，使用**postcss-px-to-viewport**插件进行px转vw或vh，通常ui设计稿为宽为750px

6. 使用**vw、vh**或者**rem**布局时，如果使用vant或第三ui库，请注意vant团队是根据375px的设计稿去做的，所以当设定以750为基准值时， vant的样式相当于缩小了一倍，所以处理方式有两种：

   ```
   1.设定375的基准值，写样式时手动除以2（比较笨的方法）
   2.改写postcss.config.js文件：
   const path = require('path');
   
   module.exports = ({ file }) => {
     const designWidth = file.dirname.includes(path.join('node_modules', 'vant')) ? 375 : 750;
   
     return {
       plugins: {
         autoprefixer: {},
         "postcss-px-to-viewport": {
           unitToConvert: "px",
           viewportWidth: designWidth,
           unitPrecision: 6,
           propList: ["*"],
           viewportUnit: "vw",
           fontViewportUnit: "vw",
           selectorBlackList: [],
           minPixelValue: 1,
           mediaQuery: true,
           exclude: [],
           landscape: false
         }
       }
     }
   
   }
   ```

7. 移动端可使用**vConsole**插件库，进行开发测试

8. 合理封装组件，遵循单向数据流原则（视组件类型而定），单文件组件尽量保持小的代码量，控制在500行内

9. 组件文件名统一大驼峰或小驼峰，不要混合使用，.vue文件内组件name使用小驼峰，使用时使用my-component

10. v-for循环必须加上key，尽量避免使用index做为key值

11. props加上验证，必要时加上默认值，且对象或数组默认值必须以函数的形式返回

12. 合理使用**vuex**，遵循两个原则的，都可以把数据封装到vuex里

    ```
    - 多个视图依赖同一状态
    - 来自不同视图的行为需要变更同一状态
    
    function test(...a1){
    a1 = [1, 2, 3]
    }
    test(1, 2, 3)
    ```

##### js相关

1. 全面拥抱es6
2. 使用let替代var，常量配置使用const
3. 对象方法不能使用箭头函数
4. 合理的命名规范
5. 对象的遍历，禁止使用for in，会产生副作用，推荐使用Object.keys + for of遍历
6. 可以尝试使用解构赋值，使代码可读性更强
7. 可使用...变量代替arguments对象获取函数参数
8. 注意深浅拷贝

## 代码Review

文档链接：http://jira.huixiaoer.com:8090/pages/viewpage.action?pageId=67666663